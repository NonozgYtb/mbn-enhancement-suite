// ==UserScript==
// @name           MonBureauNumérique Average
// @description    Met une ligne Moyenne dans MBN
// @include        http*://*.monbureaunumerique.fr/*
// @match          http*://*.monbureaunumerique.fr/*
// @run-at         document-idle
// @author         NonozgYtb
// @icon           https://cdn.monbureaunumerique.fr/images/favicon.ico
// @downloadURL    https://github.com/NonozgYtb/mbn-enhancement-suite/blob/master/mbn-average-part.js
// @updateURL      https://github.com/NonozgYtb/mbn-enhancement-suite/blob/master/mbn-average-part.js
// @version        1.0
// ==/UserScript==

!function(){"use strict";function e(e,t){var l=0,n=0;return Object.keys(e).forEach(function(t,i){n+=e[t],l++},e),e=void 0,n/=l}function t(e){return(e=new String(e)).include(".")?e:e+".0"}if(null!=document.getElementsByClassName("yui-dt-liner bulletin-note bulletin-note-eleve")){var l,n=[];for(let t=0;t<document.getElementsByClassName("yui-dt-liner bulletin-note bulletin-note-eleve").length;t++)if(l=parseFloat(new String(document.getElementsByClassName("yui-dt-liner bulletin-note bulletin-note-eleve")[t].innerText).replace(",",".")),a=document.getElementsByClassName("bulletin-matiere-libelle ellipse fw-700")[t].innerText,"number"!=typeof n[a])n[a]=l;else{n[a]=e([n[a],l]);var i=document.getElementsByClassName("bulletin-matiere-libelle ellipse fw-700")[5].parentElement.parentElement.parentElement.parentElement.lastElementChild.firstChild.firstChild.children;for(let e=0;e<i.length;e++)i[e].classList.add("devoir-facultatif"),i[e].children[0].classList.add("devoir-facultatif-note"),i[e].children[0].style.color="#bababa",i[e].children[1].classList.add("devoir-facultatif-bareme");document.getElementsByClassName("bulletin-matiere-libelle ellipse fw-700")[t].parentElement.parentElement.parentElement.parentElement.style.color="#6e6e6e",document.getElementsByClassName("bulletin-matiere-libelle ellipse fw-700")[t].parentElement.parentElement.parentElement.parentElement.firstChild.style.transform="translateX(15px)",document.getElementsByClassName("bulletin-matiere-libelle ellipse fw-700")[t].parentElement.parentElement.parentElement.parentElement.firstChild.style.boxShadow="-6px 0 #6e6e6e4f"}var s=document.createElement("tr");s.classList="yui-dt-last yui-dt-odd",s.innerHTML='<td headers="yui-dt0-th-matiere " class="yui-dt0-col-matiere yui-dt-col-matiere yui-dt-sortable yui-dt-first" style="width: 150px;"><div class="yui-dt-liner"><div class="bulletin-matiere-ligne"><div class="bulletin-matiere-libelle ellipse fw-700" title="MOYENNE">MOYENNE</div><div class="releve-matiere-professeur f-left c-both ellipse" title="NOE ZISLIN-GALERNE">NOE ZISLIN-GALERNE</div></div></div></td><td headers="yui-dt0-th-yui-dt-col1 yui-dt0-th-moyenneEleve " class="yui-dt0-col-moyenneEleve yui-dt-col-moyenneEleve yui-dt-sortable" style="width: 30px;"><div class="yui-dt-liner bulletin-note bulletin-note-eleve" id="__moyenne__"></div></td><td headers="yui-dt0-th-yui-dt-col1 yui-dt0-th-nombreDevoirComptabilises " class="yui-dt0-col-nombreDevoirComptabilises yui-dt-col-nombreDevoirComptabilises yui-dt-sortable" style="width: 30px;"><div class="yui-dt-liner bulletin-note"><div class="txt-center" id="__notes__"></div></div></td><td headers="yui-dt0-th-yui-dt-col4 yui-dt0-th-moyenneClasse " class="yui-dt0-col-moyenneClasse yui-dt-col-moyenneClasse" style="width: 30px;"><div class="yui-dt-liner bulletin-note" id="__tagsmoy__"></div></td><td headers="yui-dt0-th-yui-dt-col4 yui-dt0-th-moyenneClasseMin " class="yui-dt0-col-moyenneClasseMin yui-dt-col-moyenneClasseMin" style="width: 30px;"><div class="yui-dt-liner bulletin-note" id="__tagsmin__"></div></td><td headers="yui-dt0-th-yui-dt-col4 yui-dt0-th-moyenneClasseMax " class="yui-dt0-col-moyenneClasseMax yui-dt-col-moyenneClasseMax" style="width: 30px;"><div class="yui-dt-liner bulletin-note" id="__tagsmax__"></div></td><td headers="yui-dt0-th-notesEleve " class="yui-dt0-col-notesEleve yui-dt-col-notesEleve yui-dt-last"><div class="yui-dt-liner"><div class="list-devoirs-eleve"></div></div></td>',null!=document.getElementsByClassName("yui-dt-data")[0]&&document.getElementsByClassName("yui-dt-data")[0].appendChild(s);var a=[],d=0;document.getElementsByClassName("bulletin-note");for(let e=0;e<document.getElementsByClassName("yui-dt-liner bulletin-note").length;e++)String(document.getElementsByClassName("yui-dt-liner bulletin-note")[e].innerHTML).include("txt-center")&&a.push(document.getElementsByClassName("yui-dt-liner bulletin-note")[e].children[0]);if("function"==typeof a.each){a.each(e=>{""==e.id&&(d+=parseInt(e.innerHTML))}),document.getElementsByClassName("yui-dt-liner bulletin-note").__moyenne__.innerHTML=t(new String(e(n).toString())).replace(".",","),document.getElementById("__notes__").appendChild(document.createTextNode(d)),document.getElementsByClassName("yui-dt-liner bulletin-note").__tagsmoy__.innerHTML=t(new String(e(n).toString())).replace(".",",");var o=1/0,r=0;Object.keys(n).forEach(function(e,t){let l=n[e];l>r?r=l:l<o&&(o=l)},n),document.getElementsByClassName("yui-dt-liner bulletin-note").__tagsmin__.innerHTML=t(new String(o)).replace(".",","),document.getElementsByClassName("yui-dt-liner bulletin-note").__tagsmax__.innerHTML=t(new String(r)).replace(".",","),console.clear(),console.log("%cMonBureauNumérique Average ️\n%cMoyenne dans le tableau Evaluations%c\nFrom the/Provient de MBN Enhancement Suite%c\nAjoute des fonctions utiles à MonBureauNumérique (ENT Grand-Est)\n© 2020 NonozgYtb\nVersion: %c1.0%c\n\nSource: https://github.com/NonozgYtb/mbn-enhancement-suite\n","font-size: 25px; font-family: Arial;font-weight: bold;","font-size: 18px; font-family: Arial;font-weight: bold; padding: 10px 0;","color: #aaa; font-style: italic;","color: #aaa","color: #009378","color: #aaa")}}}();